<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Auth Service</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #f5f5f5;
        }
        .api-response {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .hidden {
            display: none;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
    <script>
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth(nickname, password) {
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                if (!nickname || !password) {
                    return '{auth=error,e=incorrectnicknameorpassword}';
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
                const response = await fetch('accounts.txt');
                if (!response.ok) {
                    return '{auth=error,e=404}';
                }

                const text = await response.text();
                const lines = text.split('\n');

                // –ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) continue;
                    
                    const parts = trimmedLine.split(':');
                    if (parts.length >= 2) {
                        const storedNick = parts[0].trim();
                        const storedPass = parts[1].trim();
                        
                        if (storedNick === nickname && storedPass === password) {
                            return `{auth=success,nickname="${nickname}",password="${password}"}`;
                        }
                    }
                }
                
                return '{auth=error,e=incorrectnicknameorpassword}';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                return '{auth=error,e=404}';
            }
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ —Ö—ç—à–∞
        function parseHashParams() {
            const hash = window.location.hash.substring(1); // –£–±–∏—Ä–∞–µ–º #
            if (!hash) return {};
            
            const params = {};
            hash.split('&').forEach(pair => {
                const [key, value] = pair.split('=');
                if (key && value) {
                    params[decodeURIComponent(key)] = decodeURIComponent(value);
                }
            });
            return params;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function initPage() {
            const params = parseHashParams();
            const hasAuthParams = params.nickname && params.password;
            
            if (hasAuthParams) {
                // –≠—Ç–æ API-–∑–∞–ø—Ä–æ—Å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const result = await checkAuth(params.nickname, params.password);
                
                // –ü—Ä—è—á–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                document.getElementById('main-content').classList.add('hidden');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const responseDiv = document.getElementById('api-response');
                responseDiv.textContent = result;
                responseDiv.classList.remove('hidden');
                
                // –ú–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã
                document.title = 'API Auth Response';
                
            } else {
                // –≠—Ç–æ –æ–±—ã—á–Ω—ã–π –≤–∏–∑–∏—Ç –Ω–∞ —Å–∞–π—Ç
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('api-response').classList.add('hidden');
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', initPage);
        
        // –¢–∞–∫–∂–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ö—ç—à–∞ (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –≤–≤–µ–¥–µ—Ç –Ω–æ–≤—ã–π URL –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
        window.addEventListener('hashchange', initPage);
    </script>
</head>
<body>
    <!-- –ë–ª–æ–∫ –¥–ª—è API-–æ—Ç–≤–µ—Ç–æ–≤ -->
    <div id="api-response" class="api-response hidden">
        <!-- –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π—Ç–∞ (–≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) -->
    <div id="main-content">
        <h1>üîê API Auth Service</h1>
        <p>–≠—Ç–æ—Ç –¥–æ–º–µ–Ω —Å–ª—É–∂–∏—Ç API —Å–µ—Ä–≤–∏—Å—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.</p>
    </div>
</body>
</html>
