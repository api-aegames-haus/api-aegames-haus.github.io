<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Auth Service</title>
    <script>
        async function checkAuth(nickname, password) {
            try {
                if (!nickname || !password) {
                    return '{auth=error,e=incorrectnicknameorpassword}';
                }

                const response = await fetch('accounts.txt');
                if (!response.ok) {
                    return '{auth=error,e=404}';
                }

                const text = await response.text();
                const lines = text.split('\n');

                for (const line of lines) {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) continue;
                    
                    const parts = trimmedLine.split(':');
                    if (parts.length >= 2) {
                        const storedNick = parts[0].trim();
                        const storedPass = parts[1].trim();
                        
                        if (storedNick === nickname && storedPass === password) {
                            return `{auth=success,nickname="${nickname}",password="${password}"}`;
                        }
                    }
                }
                
                return '{auth=error,e=incorrectnicknameorpassword}';
                
            } catch (error) {
                return '{auth=error,e=404}';
            }
        }

        function parseHashParams() {
            const hash = window.location.hash.substring(1);
            if (!hash) return {};
            
            const params = {};
            hash.split('&').forEach(pair => {
                const [key, value] = pair.split('=');
                if (key && value) {
                    params[decodeURIComponent(key)] = decodeURIComponent(value);
                }
            });
            return params;
        }

        async function initPage() {
            const params = parseHashParams();
            
            if (params.nickname && params.password) {
                const result = await checkAuth(params.nickname, params.password);
                document.open();
                document.write(result);
                document.close();
                return;
            }
            
            document.getElementById('main-content').classList.remove('hidden');
        }

        window.addEventListener('DOMContentLoaded', initPage);
        window.addEventListener('hashchange', initPage);
    </script>
</head>
<body>
    <div id="main-content" class="hidden">
        <h1>üîê API Auth Service</h1>
        <h3>–≠—Ç–æ API —Å—Ä–µ–¥–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –î–æ—Å—Ç—É–ø–Ω–∞—è —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.</h3>
    </div>
</body>
</html>
